{
    "actions": [
    {
        "type": "argument",
        "name": "pass parameters",
        "config": {
            "data": {
            	"cloud-host": "up.uat.kaisquare.com",
                "host": "192.168.1.210",
                "port": "80",
                "dev-name": "Amtk170",
                "dev-host": "192.168.1.170",
                "dev-port": "80",
                "dev-user": "admin",
                "dev-password": "",
                "platform-device-id": "4"
            }
        }
    },
    {
        "type": "http",
        "name": "login",
        "config": {
            "url": "http://{{host}}/api/kaisquare/login",
            "data": {
                "user-name": "admin",
                "password": "admin"
            },
            "values": {
            	"result": "result",
                "session": "session-key",
                "userid": "user-id"
            },
	        "check": {
	        	"result": "ok"
	        }
        }
    },
    {
    	"type": "http",
    	"name": "adddevice",
    	"config": {
    		"url": "http://{{host}}/api/kaisquare/adddevicetobucket",
    		"data": {
    			"session-key": "{{session}}",
		        "registration-number": "",
		        "device-name": "{{dev-name}}",
		        "model-id": "111",
		        "device-key": "",
		        "device-host": "{{dev-host}}",
		        "device-port": "{{dev-port}}",
		        "device-label": "",
		        "device-login": "{{dev-user}}",
		        "device-password": "{{dev-password}}",
		        "device-address": "New Taipei",
		        "device-latitude": "0",
		        "device-longitude": "0",
		        "cloud-recording-enabled": "true"
    		},
	    	"values": {
	    		"result": "result",
	    		"platform-device-id": "id",
	    		"core-device-id": "device-id"
	    	},
	    	"check": {
	    		"result": "ok",
	    		"platform-device-id": ":isdigit",
	    		"core-device-id": ":isdigit"
	    	}
    	}
    },
    {
    	"type": "http",
    	"name": "getlivevideourl",
    	"delay": 10000,
    	"retry": 3,
    	"config": {
    		"url": "http://{{host}}/api/kaisquare/getlivevideourl",
    		"data": {
    			"session-key": "{{session}}",
    			"device-id": "{{platform-device-id}}",
    			"channel-id": "0",
    			"stream-type": "rtmp/h264"
    		},
    		"values": {
    			"result": "result",
    			"video-url": "url:0"
    		},
    		"check": {
    			"result": "ok",
    			"video-url": ":notempty"
    		}
    	}
    },
    {
    	"type": "shell",
    	"name": "livevideo",
    	"ignoreError": true,
    	"config": {
    		"timeout": 10000,
    		"command": "/opt/local/bin/ffmpeg -i {{video-url}}",
    		"values": {
    			"resolution": "re:(\\d{3}x\\d{3})"
    		},
    		"check": {
    			"resolution": "640x480"
    		}
    	}
    },
    {
    	"type": "http",
    	"name": "removedevicefrombucket",
    	"config": {
    		"url": "http://{{host}}/api/kaisquare/removedevicefrombucket",
    		"data": {
    			"session-key": "{{session}}",
		        "device-id": "{{platform-device-id}}"
    		},
	    	"values": {
	    		"result": "result"
	    	},
	    	"check": {
	    		"result": "ok"
	    	}
    	}
    },
    {
        "type": "print",
        "name": "print variables",
        "config": {
        }
    }]
}
