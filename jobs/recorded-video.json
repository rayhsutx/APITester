{
    "actions": [
    {
        "type": "argument",
        "name": "pass parameters",
        "config": {
            "data": {
            	"cloud-host": "up.uat.kaisquare.com",
                "host": "192.168.1.210",
                "port": "80",
                "otp": "PRX5CX",
                "license": "XUHZS - CVP8F - UMJIW",
                "registration-number": "THF10P130531800076",
                "node-name": "Node TW 76",
                "dev-name": "Amtk170",
                "dev-host": "192.168.1.170",
                "dev-port": "80",
                "dev-user": "admin",
                "dev-password": "",
                "event-date-from": "14082014000000",
                "event-date-to": "14082014235959",
                "platform-device-id": "9"
            }
        }
    },
    {
        "type": "http",
        "name": "login",
        "config": {
            "url": "http://{{host}}/api/kaisquare/login",
            "data": {
                "user-name": "admin",
                "password": "admin"
            },
            "values": {
            	"result": "result",
                "session": "session-key",
                "userid": "user-id"
            },
	        "check": {
	        	"result": "ok"
	        }
        }
    },
    // {
    // 	"type": "http",
    // 	"name": "adddevice",
    // 	"config": {
    // 		"url": "http://{{host}}/api/kaisquare/adddevicetobucket",
    // 		"data": {
    // 			"session-key": "{{session}}",
		  //       "registration-number": "",
		  //       "device-name": "{{dev-name}}",
		  //       "model-id": "111",
		  //       "device-key": "",
		  //       "device-host": "{{dev-host}}",
		  //       "device-port": "{{dev-port}}",
		  //       "device-label": "",
		  //       "device-login": "{{dev-user}}",
		  //       "device-password": "{{dev-password}}",
		  //       "device-address": "New Taipei",
		  //       "device-latitude": "0",
		  //       "device-longitude": "0",
		  //       "cloud-recording-enabled": "true"
    // 		},
	   //  	"values": {
	   //  		"result": "result",
	   //  		"platform-device-id": "id",
	   //  		"core-device-id": "device-id"
	   //  	},
	   //  	"check": {
	   //  		"result": "ok",
	   //  		"platform-device-id": ":isdigit",
	   //  		"core-device-id": ":isdigit"
	   //  	}
    // 	}
    // },
    {
    	"type": "http",
    	"name": "getplaybackvideourl",
    	// "delay": 900000,
    	"config": {
    		"url": "http://{{host}}/api/kaisquare/getplaybackvideourl",
    		"data": {
    			"session-key": "{{session}}",
    			"device-id": "{{platform-device-id}}",
    			"channel-id": "0",
    			"stream-type": "http/h264",
    			"from": "{{event-date-from}}",
    			"to": "{{event-date-to}}"
    		},
    		"values": {
    			"result": "result",
    			"recorded-video-url": "url:0"
    		},
    		"check": {
    			"result": "ok",
    			"recorded-video-url": ":notempty"
    		}
    	}
    },
    {
    	"type": "shell",
    	"name": "download-recorded-video",
    	"timeout": 0,
    	"config": {
    		"command": "/opt/local/bin/curl -b {{__COOKIE__}} {{recorded-video-url}} -o recorded.mp4"
    	}
    },
    {
    	"type": "shell",
    	"name": "check-recorded-video",
    	"config": {
    		"command": "/opt/local/bin/ffmpeg -i recorded.mp4",
    		"values": {
    			"resolution": "re:(\\d{3}x\\d{3})"
    		},
    		"check": {
    			"resolution": "640x480"
    		}
    	}
    },
    {
    	"type": "shell",
    	"name": "delete-recorded-video",
    	"config": {
    		"command": "rm recorded.mp4"
    	}
    },
    // {
    // 	"type": "http",
    // 	"name": "removedevicefrombucket",
    // 	"config": {
    // 		"url": "http://{{host}}/api/kaisquare/removedevicefrombucket",
    // 		"data": {
    // 			"session-key": "{{session}}",
		  //       "device-id": "{{platform-device-id}}"
    // 		},
	   //  	"values": {
	   //  		"result": "result"
	   //  	},
	   //  	"check": {
	   //  		"result": "ok"
	   //  	}
    // 	}
    // },
    {
        "type": "print",
        "name": "print variables",
        "config": {
        }
    }]
}
